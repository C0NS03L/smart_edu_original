<table class="table-zebra table">
  <thead>
    <tr>
      <th><%= sort_link(@q, :name, t('tables.student.name')) %></th>
      <th><%= sort_link(@q, :date, t('tables.student.date')) %></th>
      <th><%= sort_link(@q, :check_in_time, t('tables.student.check_in_time')) %></th>
      <th><%= t('attendances.table.action') %></th>
    </tr>
  </thead>
  <tbody>
    <% @q
         .result
         .includes(:attendances)
         .to_a
         .sort_by { |student| student.attendances.maximum(:timestamp) || Time.at(0) }
         .reverse
         .each do |student| %>
      <% latest_attendance = student.attendances.order(timestamp: :desc).first %>
      <% if latest_attendance %>
        <tr class="hover">
          <td><%= student.name %></td>
          <td><%= l(attendance.timestamp, format: :date_only) %></td>
          <td><%= l(attendance.timestamp, format: :time_only) %></td>
          <td>
            <div class="flex space-x-2">
              <%= link_to student, class: 'hover:text-blue-500 text-blue-700' do %>
                <i class="fas fa-eye" title="<%= t('attendances.table.view_title') %>"></i>
                <%= t('attendances.table.view') %>
              <% end %>
              <%= link_to edit_student_path(student), class: 'hover:text-yellow-500 text-yellow-700' do %>
                <i class="fas fa-edit" title="<%= t('attendances.table.edit_title') %>"></i>
                <%= t('attendances.table.edit') %>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
